<?xml version="1.0" encoding="UTF-8"?><record_update sys_domain="global" table="sys_cb_design_topic">
    <sys_cb_design_topic action="INSERT_OR_UPDATE">
        <compiled_topic display_value="Change PIN code">19998e14db0a2700b25b4a92ba9619d4</compiled_topic>
        <design_definition>{"type":"FlowTopic","triggers":[{"type":"Trigger","name":"7b145d6c37de428c8f1ca1ed2ca4e773","triggerType":"request","applicability":{"type":"Applicability","mode":"script","value":""},"id":"7b145d6c37de428c8f1ca1ed2ca4e773"}],"goals":[{"name":"Password Reset","trigger_id":"7b145d6c37de428c8f1ca1ed2ca4e773","nodes":[{"type":"StartGoal","goal_id":"898e2530f8e140ae86ce6d7dbe8a330a","greeting_msg":{"type":"String","mode":"string","value":""},"id":"c744a2b563844df8a56e4f98cbf0b5ba","name":"Start"},{"type":"TerminateGoal","goal_id":"898e2530f8e140ae86ce6d7dbe8a330a","confirmation_msg":{"type":"String","mode":"string","value":"gs.getMessage(\"Thanks for using our support chat! Have a great day!\")"},"id":"607c8e8bb432463b8649acdec73d0336","name":"End"},{"type":"ScriptedAction","script":"(function execute() {\n    vaVars.user_name = gs.getUserName();\n\t\tvaVars.is_authenticated = '' + (vaVars.user_name != 'guest');\n    return '';\n})()\n","id":"61ea3e55f28c4b0ebd844b9acfaa0407","name":"Authentication","goal_id":"898e2530f8e140ae86ce6d7dbe8a330a"},{"type":"Decision","name":"Decision","branches":[{"type":"Branch","label":"Authenticated","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return vaVars.is_authenticated == 'true';\n})()\n"},"id":"6be48e48456b4b3098db7c1c2b466300","name":"Authenticated"},{"type":"Branch","label":"Not Authenticated","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return vaVars.is_authenticated == 'false';\n})()\n"},"id":"3ecdfc67b9d84a7883df1d8fbe438e49","name":"Not Authenticated"}],"id":"65a42e41c56f42128a327a299b7a7955","goal_id":"898e2530f8e140ae86ce6d7dbe8a330a"},{"type":"InputPrompt","variable_id":"e96b75c8a9dc414bb65e2dcf7d434c05","message":{"type":"String","mode":"string","value":"gs.getMessage(\"Please enter your email address.\")"},"optional":false,"id":"a6f56c3a2f6f46a780166cf4a4aae086","name":"Email","goal_id":"898e2530f8e140ae86ce6d7dbe8a330a"},{"type":"ScriptedAction","script":"(function execute() {\n\tvar gr = new GlideRecord('sys_user');\n\tgr.addActiveQuery();\n\tgr.addQuery('email', vaInputs.email);\n\tgr.query();\n\t\n\tvaVars.user_found = '' + gr.hasNext();\n\t\n    return '';\n})()\n","id":"a735689f155e4067bcdffd90cfb8f8e8","name":"Find User","goal_id":"898e2530f8e140ae86ce6d7dbe8a330a"},{"type":"Decision","name":"Decision","branches":[{"type":"Branch","label":"User Found","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return vaVars.user_found == 'true';\n})()\n"},"id":"6e36d4367bad419296bb2dc2242fcf18","name":"User Found"},{"type":"Branch","label":"User Not Found","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return vaVars.user_found == 'false';\n})()\n"},"id":"2f57bd910c954e9ca912a21e63e13bec","name":"User Not Found"}],"id":"05aa1053aa8d49069b9b1917312b21aa","goal_id":"898e2530f8e140ae86ce6d7dbe8a330a"},{"type":"ScriptedAction","script":"(function execute() {\n\n    function getUser() {\n        if (vaVars.user_name == 'guest') {\n            var gr = new GlideRecord('sys_user');\n            gr.addQuery('email', vaInputs.email);\n            gr.query();\n            gr.next(); \n            return gr.getUniqueValue();\n        }\n        else \n            return vaInputs.user;\n    }\n\n    var gr = new GlideRecord('pwd_enrollment');\n\tgr.addQuery('user', getUser());\n\tgr.addQuery('status', 1);\n\tgr.query();\n\t\n\tvaVars.is_enrolled = '' + gr.hasNext();\n\n    return '';\n})()\n","id":"f2c1e63d56104c91a5c58c9de8d7f8f8","name":"Check Enrollment","goal_id":"898e2530f8e140ae86ce6d7dbe8a330a"},{"type":"InputPrompt","variable_id":"68d57ce9599c467eb7aaa15b8ebe339f","message":{"type":"String","mode":"string","value":"gs.getMessage(\"I didn't find your email address. Would you like to enter another?\")"},"optional":false,"id":"be0046795b1d4cf898a596054ab9c893","name":"Repeat Email","goal_id":"898e2530f8e140ae86ce6d7dbe8a330a"},{"type":"Decision","name":"Decision","branches":[{"type":"Branch","label":"Enter Email Again","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return vaInputs.repeat_email.getValue();\n})()\n"},"id":"9619299b867c40339500bfdc5332172c","name":"Enter Email Again"},{"type":"Branch","label":"Stop Entering Email","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return !vaInputs.repeat_email.getValue();;\n})()\n"},"id":"32adf7d6e3434959821a7b714162f828","name":"Stop Entering Email"}],"id":"7eb0c7b7eac04d1ab34331a865abadab","goal_id":"898e2530f8e140ae86ce6d7dbe8a330a"},{"type":"Decision","name":"Decision","branches":[{"type":"Branch","label":"Enrolled","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return vaVars.is_enrolled == 'true';\n})()\n"},"id":"33ccb6515ea94b858f9824426a1cf76a","name":"Enrolled"},{"type":"Branch","label":"Not Enrolled","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return vaVars.is_enrolled == 'false';\n})()\n"},"id":"a4e911136d3540319c4950353f719845","name":"Not Enrolled"}],"id":"38c8235d1bc94b89821c0dd26ccc86d3","goal_id":"898e2530f8e140ae86ce6d7dbe8a330a"},{"type":"LinkOutputPrompt","header":{"type":"String","mode":"string","value":"gs.getMessage(\"Sorry, enrollment is required to reset your password. Click below to enroll.\")"},"label":{"type":"String","mode":"string","value":"gs.getMessage(\"Password Enrollment Link\")"},"url":{"type":"String","mode":"script","value":"(function execute() {\n    return gs.getProperty('glide.servlet.uri') + '/$pwd_enrollment_form_container.do';\n})()\n"},"id":"2f564c4be5a847bd9f6a59c94b2e6fd2","name":"Password Enrollment Link","goal_id":"898e2530f8e140ae86ce6d7dbe8a330a"},{"type":"ScriptedAction","script":"(function execute() {\n    \n    function getUser() {\n        if (vaVars.user_name == 'guest') {\n            var gr = new GlideRecord('sys_user');\n            gr.addQuery('email', vaInputs.email);\n            gr.query();\n            gr.next(); \n            return gr.getUniqueValue();\n        }\n        else \n            return vaInputs.user;\n    }\n    \n    // Check if User is in a Password Process group\n    function checkIfUserIsInGroup(process, userId) {\n        var process_group = new GlideRecord('pwd_map_proc_to_group');\n        process_group.addQuery('process', process.getUniqueValue());\n        process_group.query();\n        \n        while(process_group.next()) {\n            var grmember = new GlideRecord('sys_user_grmember');\n            grmember.addQuery('user', userId);\n            grmember.addQuery('group', process_group.getValue('user_group'));\n            grmember.query();\n            \n            if(grmember.hasNext()) {\n                return true;\n            }\n        }\n        \n        return false;\n    }\n    \n    var gr = new GlideRecord('pwd_process');\n\tgr.addActiveQuery();\n\tgr.addQuery('public_access', true);\n\tgr.addQuery('enabled_on_chatbot', true);\n\tgr.query();\n\n    var results = [];\n    var index = 0;\n    var userId = getUser();\n    while(gr.next()) {\n        if (gr.getValue('apply_to_all_users') == '1' || checkIfUserIsInGroup(gr, userId)) {\n            results.push(\n                {\n                    'name': gr.getDisplayValue('name'),\n                    'value': '$pwd_reset.do?sysparm_url=' + gr.getValue('url_suffix')\n                }\n            )\n            index++;\n        }\n    }\n    vaVars.pwd_reset_links = JSON.stringify(results);\n\n    return '';\n})()\n","id":"c3b6686f6ba245a49e0c83175629d45d","name":"Find Password Reset Links","goal_id":"898e2530f8e140ae86ce6d7dbe8a330a"},{"type":"Decision","name":"Decision","branches":[{"type":"Branch","label":"Links Not Found","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    var results = JSON.parse(vaVars.pwd_reset_links);\n    return results.length == 0;\n})()\n"},"id":"dcab15bf21974b0687777e814fb4ab19","name":"Links Not Found"},{"type":"Branch","label":"Links Found","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    var results = JSON.parse(vaVars.pwd_reset_links);\n    return results.length &gt; 0;\n})()\n"},"id":"ac0f8a0b51db495ca1a05b450394c970","name":"Links Found"}],"id":"8ddd08fbafdf4a40b321a2ee1584c756","goal_id":"898e2530f8e140ae86ce6d7dbe8a330a"},{"type":"LinkOutputPrompt","header":{"type":"String","mode":"script","value":"(function execute() {\n    var results = JSON.parse(vaVars.pwd_reset_links);\n    return results[parseInt(vaVars.pwd_reset_index)].name;\n})()\n"},"label":{"type":"String","mode":"string","value":"gs.getMessage(\"Reset your password.\")"},"url":{"type":"String","mode":"script","value":"(function execute() {\n    var results = JSON.parse(vaVars.pwd_reset_links);\n    var baseURL = gs.getProperty('glide.servlet.uri');\n    return baseURL + '/' + results[parseInt(vaVars.pwd_reset_index)].value;\n})()\n"},"id":"b4732745d4104d31a4f6678d05539776","name":"Password Reset Link","goal_id":"898e2530f8e140ae86ce6d7dbe8a330a"},{"type":"ScriptedAction","script":"(function execute() {\n    vaVars.pwd_reset_index = parseInt(vaVars.pwd_reset_index) + 1;\n    return '';\n})()\n","id":"42b555dec15c4c969da185619c270aa4","name":"Increment Counter","goal_id":"898e2530f8e140ae86ce6d7dbe8a330a"},{"type":"Decision","name":"Decision","branches":[{"type":"Branch","label":"No links left","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    var results = JSON.parse(vaVars.pwd_reset_links);\n    return parseInt(vaVars.pwd_reset_index) &gt;= results.length;\n})()\n"},"id":"5a4bf512d3fb43f4a07989f158df2a70","name":"No links left"},{"type":"Branch","label":"Next link","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    var results = JSON.parse(vaVars.pwd_reset_links);\n    return parseInt(vaVars.pwd_reset_index) &lt; results.length;\n})()\n"},"id":"7af5102450b74a8c9a37be1fa0dd60e5","name":"Next link"}],"id":"a6546fc160eb48dea54d54aacd04cb76","goal_id":"898e2530f8e140ae86ce6d7dbe8a330a"},{"type":"Decision","name":"Decision","branches":[{"type":"Branch","label":"Authenticated","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return vaVars.is_authenticated == 'true';;\n})()\n"},"id":"f1aa7736ce2c45729f4e458facda9bbb","name":"Authenticated"},{"type":"Branch","label":"Not Authenticated","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return vaVars.is_authenticated != 'true';\n})()\n"},"id":"1b2c1796292d4544b5e97c66babd00a4","name":"Not Authenticated"}],"id":"5756b79d94d948f28a44576241c9ed38","goal_id":"898e2530f8e140ae86ce6d7dbe8a330a"},{"type":"OutputPrompt","value":{"type":"String","mode":"string","value":"gs.getMessage(\"Sorry, I can't reset your password. Please contact the service desk for help.\")"},"id":"5edcd70776b04e99b6fb25c716443c72","name":"Contact Support","goal_id":"898e2530f8e140ae86ce6d7dbe8a330a"}],"edges":[{"type":"Edge","source_node_id":"8ddd08fbafdf4a40b321a2ee1584c756","target_node_id":"5edcd70776b04e99b6fb25c716443c72","branch_id":"dcab15bf21974b0687777e814fb4ab19","id":"f72011f76535436eab53625d1bc47d05","name":"dcab15bf21974b0687777e814fb4ab19"},{"type":"Edge","source_node_id":"2f564c4be5a847bd9f6a59c94b2e6fd2","target_node_id":"607c8e8bb432463b8649acdec73d0336","id":"7f1b94fccbe843b481049ad1fd7a6e56"},{"type":"Edge","source_node_id":"c744a2b563844df8a56e4f98cbf0b5ba","target_node_id":"61ea3e55f28c4b0ebd844b9acfaa0407","id":"04210027d01b4dd8bd7014812c72ca2e"},{"type":"Edge","source_node_id":"61ea3e55f28c4b0ebd844b9acfaa0407","target_node_id":"65a42e41c56f42128a327a299b7a7955","id":"9e30f80d52a841519b430d542b2f6eb4"},{"type":"Edge","source_node_id":"65a42e41c56f42128a327a299b7a7955","target_node_id":"f2c1e63d56104c91a5c58c9de8d7f8f8","branch_id":"6be48e48456b4b3098db7c1c2b466300","id":"7db672422e27487b84f6168aea5b0a8e","name":"6be48e48456b4b3098db7c1c2b466300"},{"type":"Edge","source_node_id":"65a42e41c56f42128a327a299b7a7955","target_node_id":"a6f56c3a2f6f46a780166cf4a4aae086","branch_id":"3ecdfc67b9d84a7883df1d8fbe438e49","id":"22b6721015974bb391a6cfaa83022c3d","name":"3ecdfc67b9d84a7883df1d8fbe438e49"},{"type":"Edge","source_node_id":"a6f56c3a2f6f46a780166cf4a4aae086","target_node_id":"a735689f155e4067bcdffd90cfb8f8e8","id":"d832c17494aa4958baf4ca0962ee24e5"},{"type":"Edge","source_node_id":"a735689f155e4067bcdffd90cfb8f8e8","target_node_id":"05aa1053aa8d49069b9b1917312b21aa","id":"cebfab836de54708907cde263e611daa"},{"type":"Edge","source_node_id":"05aa1053aa8d49069b9b1917312b21aa","target_node_id":"f2c1e63d56104c91a5c58c9de8d7f8f8","branch_id":"6e36d4367bad419296bb2dc2242fcf18","id":"efcfd9357aa94290a16cf20ed2ff910a","name":"6e36d4367bad419296bb2dc2242fcf18"},{"type":"Edge","source_node_id":"05aa1053aa8d49069b9b1917312b21aa","target_node_id":"be0046795b1d4cf898a596054ab9c893","branch_id":"2f57bd910c954e9ca912a21e63e13bec","id":"f276e86eaf2a49deac740d0a85d9a37d","name":"2f57bd910c954e9ca912a21e63e13bec"},{"type":"Edge","source_node_id":"be0046795b1d4cf898a596054ab9c893","target_node_id":"7eb0c7b7eac04d1ab34331a865abadab","id":"5cd57a40731e449e8a073c89da7d39b8"},{"type":"Edge","source_node_id":"7eb0c7b7eac04d1ab34331a865abadab","target_node_id":"a6f56c3a2f6f46a780166cf4a4aae086","branch_id":"9619299b867c40339500bfdc5332172c","id":"d8afa1b828cf4461855bc06b03de91e2","name":"9619299b867c40339500bfdc5332172c"},{"type":"Edge","source_node_id":"7eb0c7b7eac04d1ab34331a865abadab","target_node_id":"607c8e8bb432463b8649acdec73d0336","branch_id":"32adf7d6e3434959821a7b714162f828","id":"736f43f0b5a849ffafee6901110f97a9","name":"32adf7d6e3434959821a7b714162f828"},{"type":"Edge","source_node_id":"f2c1e63d56104c91a5c58c9de8d7f8f8","target_node_id":"38c8235d1bc94b89821c0dd26ccc86d3","id":"8860857d2b6b453b9ad8a84577bc31a8"},{"type":"Edge","source_node_id":"38c8235d1bc94b89821c0dd26ccc86d3","target_node_id":"c3b6686f6ba245a49e0c83175629d45d","branch_id":"33ccb6515ea94b858f9824426a1cf76a","id":"9aa943d369e3410ca7d7a565ebf33a10","name":"33ccb6515ea94b858f9824426a1cf76a"},{"type":"Edge","source_node_id":"c3b6686f6ba245a49e0c83175629d45d","target_node_id":"8ddd08fbafdf4a40b321a2ee1584c756","id":"08330199450d4309b41badee874321c0"},{"type":"Edge","source_node_id":"8ddd08fbafdf4a40b321a2ee1584c756","target_node_id":"b4732745d4104d31a4f6678d05539776","branch_id":"ac0f8a0b51db495ca1a05b450394c970","id":"9a514bd631434963aa0929a59da506b3","name":"ac0f8a0b51db495ca1a05b450394c970"},{"type":"Edge","source_node_id":"b4732745d4104d31a4f6678d05539776","target_node_id":"42b555dec15c4c969da185619c270aa4","id":"3e841422619b41a89a98ce47365623c2"},{"type":"Edge","source_node_id":"42b555dec15c4c969da185619c270aa4","target_node_id":"a6546fc160eb48dea54d54aacd04cb76","id":"1b5a7434e5824ef3888ab50900bba9cb"},{"type":"Edge","source_node_id":"a6546fc160eb48dea54d54aacd04cb76","target_node_id":"607c8e8bb432463b8649acdec73d0336","branch_id":"5a4bf512d3fb43f4a07989f158df2a70","id":"3f4c2e98010345dbac2eda63f7e100ca","name":"5a4bf512d3fb43f4a07989f158df2a70"},{"type":"Edge","source_node_id":"a6546fc160eb48dea54d54aacd04cb76","target_node_id":"b4732745d4104d31a4f6678d05539776","branch_id":"7af5102450b74a8c9a37be1fa0dd60e5","id":"002e8102f2984a41b96803b3e6d74030","name":"7af5102450b74a8c9a37be1fa0dd60e5"},{"type":"Edge","source_node_id":"38c8235d1bc94b89821c0dd26ccc86d3","target_node_id":"5756b79d94d948f28a44576241c9ed38","branch_id":"a4e911136d3540319c4950353f719845","id":"cf306a0e06a146b3a2718e6f189d24ab","name":"a4e911136d3540319c4950353f719845"},{"type":"Edge","source_node_id":"5756b79d94d948f28a44576241c9ed38","target_node_id":"2f564c4be5a847bd9f6a59c94b2e6fd2","branch_id":"f1aa7736ce2c45729f4e458facda9bbb","id":"c00e62f6e5d2441ba6108b0c8e0de083","name":"f1aa7736ce2c45729f4e458facda9bbb"},{"type":"Edge","source_node_id":"5756b79d94d948f28a44576241c9ed38","target_node_id":"5edcd70776b04e99b6fb25c716443c72","branch_id":"1b2c1796292d4544b5e97c66babd00a4","id":"6b0e5136fa184c4aa250bb7c4c1c3443","name":"1b2c1796292d4544b5e97c66babd00a4"},{"type":"Edge","source_node_id":"5edcd70776b04e99b6fb25c716443c72","target_node_id":"607c8e8bb432463b8649acdec73d0336","id":"a8201775060141cda6f72a05adcac45a"}],"id":"898e2530f8e140ae86ce6d7dbe8a330a"}],"script_variables":[{"type":"String","name":"is_authenticated","value":{"type":"String","mode":"string","value":"false"},"id":"b6f8bc13f08546f79aedb7d56b7ca666"},{"type":"String","name":"is_enrolled","value":{"type":"String","mode":"string","value":"false"},"id":"4d39fbf6e3b74c75b299d724009305fe"},{"type":"String","name":"user_found","value":{"type":"String","mode":"string","value":"false"},"id":"de5adddfde834b99a2e29072ad92b0ef"},{"type":"String","name":"pwd_reset_links","id":"9c4d867ca600428da2a4cb736f22b14f"},{"type":"String","name":"pwd_reset_index","value":{"type":"String","mode":"string","value":"0"},"id":"5cb1bacd43414ab2a35bfb469a15cc89"},{"type":"String","name":"user_name","value":{"type":"String","mode":"string","value":""},"id":"c6f83a34604e40fd974db273d740aa59"},{"type":"String","name":"LiveAgent_application","value":{"type":"String","mode":"string","value":"itsm"},"id":"19c6d8876a59411596455b3fa8418069"}],"glide_variables":[{"type":"String","name":"email","id":"e96b75c8a9dc414bb65e2dcf7d434c05"},{"type":"True/False","id":"68d57ce9599c467eb7aaa15b8ebe339f","name":"repeat_email"}],"applicability":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return !gs.hasRole('snc_external') || gs.hasRole('admin');\n})()\n"},"roles":["public"],"scope":"c9532e04db4ae300f00ddf8b4b961924","id":"68998a14db0a2700b25b4a92ba961910","name":"Change PIN code","key_phrases":["locked out","password","forgot","reset"]}</design_definition>
        <design_topic_id>68998a14db0a2700b25b4a92ba961910</design_topic_id>
        <name>Change PIN code</name>
        <sys_class_name>sys_cb_design_topic</sys_class_name>
        <sys_created_by>juha.kujala@sofigate.com</sys_created_by>
        <sys_created_on>2018-11-24 09:21:19</sys_created_on>
        <sys_domain>global</sys_domain>
        <sys_id>d5994254db0a2700b25b4a92ba961945</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name>FlowTopic</sys_name>
        <sys_package display_value="Smart traffic" source="x_snc_smart_traffi">c9532e04db4ae300f00ddf8b4b961924</sys_package>
        <sys_policy/>
        <sys_scope display_value="Smart traffic">c9532e04db4ae300f00ddf8b4b961924</sys_scope>
        <sys_update_name>sys_cb_design_topic_d5994254db0a2700b25b4a92ba961945</sys_update_name>
        <sys_updated_by>juha.kujala@sofigate.com</sys_updated_by>
        <sys_updated_on>2018-11-24 09:21:19</sys_updated_on>
        <type>FlowTopic</type>
    </sys_cb_design_topic>
</record_update>
