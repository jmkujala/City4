<?xml version="1.0" encoding="UTF-8"?><record_update sys_domain="global" table="sys_cb_design_topic">
    <sys_cb_design_topic action="INSERT_OR_UPDATE">
        <compiled_topic display_value="Load money on travel card">04690e14db0a2700b25b4a92ba9619cd</compiled_topic>
        <design_definition>{"type":"FlowTopic","triggers":[{"type":"Trigger","name":"9ee59bde1c6b4fb9b265fee5b450c300","triggerType":"request","applicability":{"type":"Applicability","mode":"script","value":""},"id":"9ee59bde1c6b4fb9b265fee5b450c300"}],"goals":[{"name":"Catalog Item Search","trigger_id":"9ee59bde1c6b4fb9b265fee5b450c300","nodes":[{"type":"StartGoal","goal_id":"ca72b5ba2ec848c780930dd57a6b6049","greeting_msg":{"type":"String","mode":"string","value":""},"id":"81fcd517508e49db8e9e55771acd20b6","name":"Start"},{"type":"TerminateGoal","goal_id":"ca72b5ba2ec848c780930dd57a6b6049","confirmation_msg":{"type":"String","mode":"string","value":""},"id":"8207df8d425a461c84ba23f49d04a69f","name":"End"},{"type":"CarouselInputPrompt","carousel_options_script":"(function execute() {\n    var results = JSON.parse(vaVars.results);\n    var baseURL = gs.getProperty('glide.servlet.uri');\n    var options = [];\n    for (var i=0; i&lt; results.length; i++) {\n        options.push(\n            {\n                'Name': results[i].title,\n                'Value': i + '',\n                'Body': baseURL + '/' + results[i].image\n            }\n        );\n    }\n    return options;\n})()\n","no_options_found_message":{"type":"String","mode":"string","value":"gs.getMessage(\"No Records Found\")"},"id":"b794b209237c4b9889d6b3fe8e045824","name":"Catalog Item","goal_id":"ca72b5ba2ec848c780930dd57a6b6049","variable_id":"8d3b1ed0066948d1a2089e875e4704c2","message":{"type":"String","mode":"string","value":"gs.getMessage(\"Here’s what I have available.  You'll have a chance to confirm or cancel the order next.\")"},"optional":false},{"type":"InputPrompt","variable_id":"17b4d49ef8334ebc8900868c6bc4c4c3","message":{"type":"String","mode":"string","value":"gs.getMessage(\"Please enter a short description of what you're looking for.\")"},"optional":false,"id":"fae5cd363a364039a4a2d5fbfc5bf8ae","name":"Search Term","goal_id":"ca72b5ba2ec848c780930dd57a6b6049"},{"type":"ScriptedAction","script":"(function execute() {\n    var search_term = vaInputs.search_term;\n    var context = '6f7e3f565b30130070e4492c11f91aea';\n\n    var contextualSearch = new sn_itsm_va.VAContextualSearchUtil();\n    var response = contextualSearch.search(context, search_term);\n\n    var success = contextualSearch.processSearchResponse(response);\n    if (!success) {\n        vaVars.count = 0;\n        return '';\n    }\n\n    //Filter out any catalog items that should not be shown ie. Record Producers\n    //create a filterMap to quickly see if item can be shown to user\n    var filter_tables = vaVars.filter_tables.split(',');\n    var filterMap = {};\n    for (var i=0; i &lt; filter_tables.length; i++) {\n        filterMap[filter_tables[i]] = 'true';\n    }\n\n    var searchResults = response.results;\n    var results = [];\n    var count = 0;\n    for (var index=0; index &lt; searchResults.length &amp;&amp; count &lt; parseInt(vaVars.limit); index++) {\n        //Get sys_id of search result\n        var sys_id = searchResults[index].id.split(':')[1];\n        //Lookup item to find the tableName\n        var gr = new GlideRecord('sc_cat_item');\n        if (gr.get(sys_id)) {\n            var tableName = gr.getValue('sys_class_name');\n            //if the tableName is not found in filterMap, we can show it to user\n            if (filterMap[tableName] == undefined) {\n                results.push({\n                    'sys_id': sys_id,\n                    'title': searchResults[index].title,\n                    'image': searchResults[index].image.link\n                });\n                count++;\n            }\n        }\n    }\n\n    vaVars.count = results.length;\n    vaVars.results = JSON.stringify(results);\n\n    return '';\n})()\n","id":"9943c542307e46ab97cda5e8cb2054e2","name":"Contextual Search","goal_id":"ca72b5ba2ec848c780930dd57a6b6049"},{"type":"Decision","name":"Decision","branches":[{"type":"Branch","label":"More than One Item","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return parseInt(vaVars.count) &gt; 1;\n})()\n"},"id":"f8f747d7ce764971837325db3c851b35","name":"More than One Item"},{"type":"Branch","label":"Only One Item","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return parseInt(vaVars.count) == 1;\n})()\n"},"id":"018866742c81436dba9ed5997ec7f21d","name":"Only One Item"},{"type":"Branch","label":"No Items Exist","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return parseInt(vaVars.count) == 0;\n})()\n"},"id":"8a789cec90d2470387eaeea2fc36c421","name":"No Items Exist"}],"id":"a26dfad5e9734bde8b64fbb976808656","goal_id":"ca72b5ba2ec848c780930dd57a6b6049"},{"type":"Decision","name":"Decision","branches":[{"type":"Branch","label":"Try Again","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return vaInputs.search_again.getValue();\n})()\n"},"id":"874c8389d6a34974a1c384614334b86f","name":"Try Again"},{"type":"Branch","label":"Cancel","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return !vaInputs.search_again.getValue();\n})()\n"},"id":"1909a52d87d94314b6ef645d9cf94261","name":"Cancel"}],"id":"b3ddd12a1f904406b3908692850919bc","goal_id":"ca72b5ba2ec848c780930dd57a6b6049"},{"type":"ImageOutputPrompt","url":{"type":"String","mode":"script","value":"(function execute() {\n    var results = JSON.parse(vaVars.results);\n    var baseURL = gs.getProperty('glide.servlet.uri');\n    return baseURL + '/' + results[0].image;\n})()\n"},"id":"ae428b5c690842a198d25b0a7d919123","name":"Item Image","goal_id":"ca72b5ba2ec848c780930dd57a6b6049"},{"type":"ScriptedAction","script":"(function execute() {\n    var results = JSON.parse(vaVars.results);\n    var index = 0;\n    if (parseInt(vaVars.count) &gt; 1) {\n        index = parseInt(vaInputs.catalog_item);\n    }\n    vaVars.selected_title = results[index].title;\n    vaVars.selected_link = gs.getProperty('sn_itsm_va.com.snc.itsm.virtualagent.portal_url') + \n        '?id=sc_cat_item&amp;sys_id=' + results[index].sys_id;\n    return '';\n})()\n","id":"61c2275096ea4ed1bdab3ccb00aea67a","name":"Set Selected Item","goal_id":"ca72b5ba2ec848c780930dd57a6b6049"},{"type":"Decision","name":"Decision","branches":[{"type":"Branch","label":"Image Exists","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    var results = JSON.parse(vaVars.results);\n    return (results[0].image != '');\n})()\n"},"id":"916e5675c7994c5ea1ae3e85e5a6d01a","name":"Image Exists"},{"type":"Branch","label":"No Image","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    var results = JSON.parse(vaVars.results);\n    return (results[0].image == '');\n})()\n"},"id":"8c01ecbbf98244bfaf23d7a1a0f5cbf5","name":"No Image"}],"id":"3d8d75a2c64440088938fd076d2ef2a4","goal_id":"ca72b5ba2ec848c780930dd57a6b6049"},{"type":"OutputPrompt","value":{"type":"String","mode":"string","value":"gs.getMessage(\"Sorry, but I couldn’t find any relevant items.\")"},"id":"f8e22fb6e2d5492888194428d422d79d","name":"No Items Found","goal_id":"ca72b5ba2ec848c780930dd57a6b6049"},{"type":"InputPrompt","variable_id":"bffcb9ffbbef47819caeeac6c8d22114","message":{"type":"String","mode":"string","value":"gs.getMessage(\"Would you like to search for something else?\")"},"optional":false,"id":"e255434a209c43d29cc268597dec3b20","name":"Search Again","goal_id":"ca72b5ba2ec848c780930dd57a6b6049"},{"type":"LinkOutputPrompt","header":{"type":"String","mode":"script","value":"(function execute() {\n    if (parseInt(vaVars.count) == 1)\n        return gs.getMessage('The only item I found is {0}.', vaVars.selected_title);\n\n    return question = gs.getMessage('OK, you chose {0}.', vaVars.selected_title);\n})()\n"},"label":{"type":"String","mode":"string","value":"gs.getMessage(\"Order your item here.\")"},"url":{"type":"String","mode":"script","value":"(function execute() {\n    return gs.getProperty('glide.servlet.uri') + '/' + vaVars.selected_link;\n})()\n"},"id":"ab27312a3e3d4c869ae8fa0526d3d8fb","name":"Link Output","goal_id":"ca72b5ba2ec848c780930dd57a6b6049"},{"type":"OutputPrompt","value":{"type":"String","mode":"string","value":"gs.getMessage(\"Thanks for using our support chat! Have a great day!\")"},"id":"62b1c9663d3a4297bcbe87b8003adc1c","name":"Acknowledgement","goal_id":"ca72b5ba2ec848c780930dd57a6b6049"}],"edges":[{"type":"Edge","source_node_id":"f8e22fb6e2d5492888194428d422d79d","target_node_id":"e255434a209c43d29cc268597dec3b20","id":"4c3701a68ae24fdab343ebf40c6fab8c"},{"type":"Edge","source_node_id":"b3ddd12a1f904406b3908692850919bc","target_node_id":"fae5cd363a364039a4a2d5fbfc5bf8ae","branch_id":"874c8389d6a34974a1c384614334b86f","id":"1e1df8e1e5094f3dae153ee87a73e1b4","name":"874c8389d6a34974a1c384614334b86f"},{"type":"Edge","source_node_id":"b794b209237c4b9889d6b3fe8e045824","target_node_id":"61c2275096ea4ed1bdab3ccb00aea67a","id":"56e4817e3a144ab7b0955df3a97a73f8"},{"type":"Edge","source_node_id":"81fcd517508e49db8e9e55771acd20b6","target_node_id":"fae5cd363a364039a4a2d5fbfc5bf8ae","id":"8c1a8ca9b20947eb881f9aa6ab43237b"},{"type":"Edge","source_node_id":"fae5cd363a364039a4a2d5fbfc5bf8ae","target_node_id":"9943c542307e46ab97cda5e8cb2054e2","id":"b6232774a5ff4c12970b4467e47200ae"},{"type":"Edge","source_node_id":"9943c542307e46ab97cda5e8cb2054e2","target_node_id":"a26dfad5e9734bde8b64fbb976808656","id":"6ad0d6fa5ceb43b784925f069d284fb1"},{"type":"Edge","source_node_id":"a26dfad5e9734bde8b64fbb976808656","target_node_id":"b794b209237c4b9889d6b3fe8e045824","branch_id":"f8f747d7ce764971837325db3c851b35","id":"eab7e51e49944e8981ebe91757f9bca0","name":"f8f747d7ce764971837325db3c851b35"},{"type":"Edge","source_node_id":"ae428b5c690842a198d25b0a7d919123","target_node_id":"61c2275096ea4ed1bdab3ccb00aea67a","id":"4146683d2ab04d96a3ece899a8d13b77"},{"type":"Edge","source_node_id":"a26dfad5e9734bde8b64fbb976808656","target_node_id":"3d8d75a2c64440088938fd076d2ef2a4","branch_id":"018866742c81436dba9ed5997ec7f21d","id":"ddb94d8d8e454f68925a1c969741a001","name":"018866742c81436dba9ed5997ec7f21d"},{"type":"Edge","source_node_id":"3d8d75a2c64440088938fd076d2ef2a4","target_node_id":"ae428b5c690842a198d25b0a7d919123","branch_id":"916e5675c7994c5ea1ae3e85e5a6d01a","id":"ccfc7dd761754640bee88d94856b1fbd","name":"916e5675c7994c5ea1ae3e85e5a6d01a"},{"type":"Edge","source_node_id":"3d8d75a2c64440088938fd076d2ef2a4","target_node_id":"61c2275096ea4ed1bdab3ccb00aea67a","branch_id":"8c01ecbbf98244bfaf23d7a1a0f5cbf5","id":"af362a5e410c4958bf6615ea63a9870e","name":"8c01ecbbf98244bfaf23d7a1a0f5cbf5"},{"type":"Edge","source_node_id":"a26dfad5e9734bde8b64fbb976808656","target_node_id":"f8e22fb6e2d5492888194428d422d79d","branch_id":"8a789cec90d2470387eaeea2fc36c421","id":"77caf929a6a748dfa29a3a6a58b0d2bb","name":"8a789cec90d2470387eaeea2fc36c421"},{"type":"Edge","source_node_id":"e255434a209c43d29cc268597dec3b20","target_node_id":"b3ddd12a1f904406b3908692850919bc","id":"b80a93fb81114d52a77446c88b22722d"},{"type":"Edge","source_node_id":"61c2275096ea4ed1bdab3ccb00aea67a","target_node_id":"ab27312a3e3d4c869ae8fa0526d3d8fb","id":"7e28e6d1d940482e89805e75cd9b0eb3"},{"type":"Edge","source_node_id":"ab27312a3e3d4c869ae8fa0526d3d8fb","target_node_id":"e255434a209c43d29cc268597dec3b20","id":"de5f36145adc4d04a0731419aea15d72"},{"type":"Edge","source_node_id":"b3ddd12a1f904406b3908692850919bc","target_node_id":"62b1c9663d3a4297bcbe87b8003adc1c","branch_id":"1909a52d87d94314b6ef645d9cf94261","id":"1ce4278da6de435a9c89ff6de089e0d4","name":"1909a52d87d94314b6ef645d9cf94261"},{"type":"Edge","source_node_id":"62b1c9663d3a4297bcbe87b8003adc1c","target_node_id":"8207df8d425a461c84ba23f49d04a69f","id":"185b130d7d9c4e80857e08d2e17f012d"}],"id":"ca72b5ba2ec848c780930dd57a6b6049"}],"script_variables":[{"type":"String","name":"limit","value":{"type":"String","mode":"string","value":"5"},"id":"1e086b318b2f4a2d8cec165a7130eed6"},{"type":"String","name":"count","value":{"type":"String","mode":"string","value":"0"},"id":"8da84c8e727343988d7037573926c1ec"},{"type":"String","name":"results","id":"a0e3f935e1264ecaa83f52c19737f3ca"},{"type":"String","name":"selected_title","id":"29aee3544d584945b3c51e538251ce68"},{"type":"String","name":"selected_link","id":"d9185a761baf49f0ab7096e1e5c6a24f"},{"type":"String","name":"filter_tables","value":{"type":"String","mode":"string","value":"sc_cat_item_content,sc_cat_item_producer,sc_cat_item_wizard,std_change_record_producer,sc_cat_item_producer_service"},"id":"b09bbc7f5e494d0a88b077c63adcd934"},{"type":"String","name":"LiveAgent_application","value":{"type":"String","mode":"string","value":"itsm"},"id":"5b3532f0876b4e51ab5728a017246454"}],"glide_variables":[{"type":"CarouselImage","id":"8d3b1ed0066948d1a2089e875e4704c2","name":"catalog_item"},{"type":"String","name":"search_term","id":"17b4d49ef8334ebc8900868c6bc4c4c3"},{"type":"True/False","id":"bffcb9ffbbef47819caeeac6c8d22114","name":"search_again"}],"applicability":{"type":"Applicability","mode":"script","value":""},"roles":[],"scope":"c9532e04db4ae300f00ddf8b4b961924","id":"b2590e14db0a2700b25b4a92ba961951","name":"Load money on travel card","key_phrases":["request","buy","item","catalog","purchase","order","computer","phone","need","require"]}</design_definition>
        <design_topic_id>b2590e14db0a2700b25b4a92ba961951</design_topic_id>
        <name>Load money on travel card</name>
        <sys_class_name>sys_cb_design_topic</sys_class_name>
        <sys_created_by>juha.kujala@sofigate.com</sys_created_by>
        <sys_created_on>2018-11-24 09:20:25</sys_created_on>
        <sys_domain>global</sys_domain>
        <sys_id>cc690e14db0a2700b25b4a92ba9619d0</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name>FlowTopic</sys_name>
        <sys_package display_value="Smart traffic" source="x_snc_smart_traffi">c9532e04db4ae300f00ddf8b4b961924</sys_package>
        <sys_policy/>
        <sys_scope display_value="Smart traffic">c9532e04db4ae300f00ddf8b4b961924</sys_scope>
        <sys_update_name>sys_cb_design_topic_cc690e14db0a2700b25b4a92ba9619d0</sys_update_name>
        <sys_updated_by>juha.kujala@sofigate.com</sys_updated_by>
        <sys_updated_on>2018-11-24 09:20:25</sys_updated_on>
        <type>FlowTopic</type>
    </sys_cb_design_topic>
</record_update>
